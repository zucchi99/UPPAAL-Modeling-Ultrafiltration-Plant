# Hybrid Modeling, Simulation, and Sub-Optimal Synthesis of a controller for the Ultrafiltration of Industrial Wastewater
The aim of this work is to model, simulate and optimize an ultrafiltration process.
A detailed specification of how the experiments were conducted (and thus of the data collection) is available on this repository in the master's thesis of Francesco Zuccato (of which we report here its abstract).

## Thesis Abstract
Historically, many industries have required large amounts of fresh water for their processes. The typical
water cycle involves buying fresh water, using it in the process, and disposing of the wastewater without
recovery, necessitating a constant supply of new water. This pattern is known as *“take-make-dispose”*
and has always been the standard, according to the traditional economy. But nowadays, **water has become a scarce resource**.

The objective of this thesis is to exploit and adapt solid formal methods and tools developed in the
area of Computer Science with the aim of reducing the water footprint of industries, helping them in the
transition **towards a circular economy**. Ultrafiltration (UF) is an industrial process used to purify
liquids by filtering them through specialized membranes. In particular, UF is a crucial technology for
pretreating wastewater, enabling its reintroduction into the industrial process. With UF, is possible to
filter a large volume of wastewater, producing a small amount of solid waste and a significant amount
of reusable clean water.

In this thesis, we first examined formal tools for representing complex real systems, such as Timed
Automata (TA) and **Hybrid Automata (HA)**. Unfortunately, many problems with HA are well-known
to be undecidable. To analyze and verify properties of HA, we employed Statistical Model Checking
(SMC). SMC is a Monte Carlo-based method that allows to estimate system’s properties without requiring
a complete formal analysis.

Then, we develop a computational model to study, simulate, and **optimize an ultrafiltration process**. 
The model relies on Hybrid Automata, a formal object designed to describe complex systems
that exhibit both continuous and discrete behaviors in their dynamics. The model is composed of two
main components: one is the environment, in which ultrafiltration is simulated using ordinary differential
equations, and the other is the controller, which can alter the working conditions.

The hybrid automaton is implemented in **Uppaal**, a software tool for modeling, simulating, and
verifying real-time systems. Uppaal Stratego enables the **synthesis of sub-optimal controllers** based
on a given cost function. Utilizing SMC, Stratego explores a finite number of possible executions (finite
traces) to minimize a cost function, which in ultrafiltration is primarily energy consumption.

Finally, we present the experimental results, demonstrating that the model’s simulated data closely
estimates real data. Additionally, we show how various strategies can be defined and optimized, such as
minimizing total energy consumption for a cost-effective approach or minimizing total time for a faster
solution.

## Repository Structure
Folders:
 * **main**: apart from the below explained sub-directories, the main folder contains the following files: 
    * ```main.py```: executes the entire data analysis (by typing ```python3 main.py```). Some parameters (such as the handling possible outliers) can be set with the the file ```parameters.json```. At the moment it is not possible to pass the parameters as arguments to the ```main.py``` file.
    *  ```parameters.json```: contains the parameters for the ```main.py``` file. Allows to customize some behaviours during the data analysis. Yet, the whole analysis has been tested only with the default parameters.
    * ```Dockerfile```: contains the docker instructions to build the docker image.
    * ```download_and_install_container.sh```: contains the shell instructions that automatically build the image and start the container.
    * ```TODO```: contains the set of next features to be implemented.
 * **src**: contains python files and notebooks for the preliminary data analysis part and for the estimation of coefficient and parameters necessary to simulate the experiments in UPPAAL.
 * **.docker**: contains the file ```requirements.txt```, which specifies the set of needed python packages, that can be automatically installed using docker.
 * **output**: contains all the output files generated by the data analysis. In particular it stores the following sub-directories:
    * **notebooks_html**: contains the export of all the run notebooks. Note that the first notebooks are computed many times, one for each experiment setting. From the html files one can easily debug and check step-by-step the executed operations.
    * **estimated_coefficients**: contains the file ```estimated_coefficients.json``` which lists for each response variable $y$ the set of explanatory variables $x_1, ..., x_n$ with the corresponding coefficients $a_1, ..., a_n$ that allow the estimation of $y$ using a linear model of the $x$ variables: $y = a_1 * x_1 + .... + a_n * x_n$.
    * **images**: contains the charts exported from the notebooks.

## Source Files - Data Analysis (Python)
The data analysis part is implemented in python, by a sequence of different python notebooks.

